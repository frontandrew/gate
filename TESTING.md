# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é API

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (PostgreSQL, Redis)
make docker-up

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate-up

# –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
make seed

# –ó–∞–ø—É—Å—Ç–∏—Ç—å API —Å–µ—Ä–≤–µ—Ä
make run-d
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8080`

### 2. –ò–º–ø–æ—Ä—Ç –≤ Postman

1. –û—Ç–∫—Ä–æ–π—Ç–µ Postman
2. –ù–∞–∂–º–∏—Ç–µ **Import** –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã:
   - `GATE_API.postman_collection.json` - –∫–æ–ª–ª–µ–∫—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
   - `GATE_API.postman_environment.json` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. –í—ã–±–µ—Ä–∏—Ç–µ environment **"GATE API - Local Development"** –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

### üìÅ Health
- **Health Check** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API

### üìÅ Authentication
- **Register New User** - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **Login** - –≤—Ö–æ–¥ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω)
- **Get Current User (Me)** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

### üìÅ Vehicles
- **Create Vehicle** - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- **Get My Vehicles** - —Å–ø–∏—Å–æ–∫ –º–æ–∏—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- **Get Vehicle by ID** - –¥–µ—Ç–∞–ª–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è

### üìÅ Passes
- **Get My Passes** - –º–æ–∏ –ø—Ä–æ–ø—É—Å–∫–∞
- **Get Pass by ID** - –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–ø—É—Å–∫–∞
- **Create Pass** ‚ö†Ô∏è *admin/guard only* - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞
- **Revoke Pass** ‚ö†Ô∏è *admin/guard only* - –æ—Ç–∑—ã–≤ –ø—Ä–æ–ø—É—Å–∫–∞

### üìÅ Access Control
- **Check Access (Gate)** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (–¥–ª—è –≤–æ—Ä–æ—Ç/–∫–∞–º–µ—Ä)
- **Get My Access Logs** - –º–æ—è –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∑–¥–æ–≤
- **Get Vehicle Access Logs** - –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∑–¥–æ–≤ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- **Get All Access Logs** ‚ö†Ô∏è *admin/guard only* - –≤—Å–µ –ª–æ–≥–∏

### üìÅ Test Users (seed data)
- **Login as Admin** - –≤—Ö–æ–¥ –∫–∞–∫ –∞–¥–º–∏–Ω
- **Login as Ivan** - –≤—Ö–æ–¥ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- **Login as Guard** - –≤—Ö–æ–¥ –∫–∞–∫ –æ—Ö—Ä–∞–Ω–Ω–∏–∫

---

## –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–º–µ—é—Ç –ø–∞—Ä–æ–ª—å: **`password123`**

| Email | –†–æ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| `admin@gate.com` | admin | –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º |
| `ivan@example.com` | user | 2 –∞–≤—Ç–æ–º–æ–±–∏–ª—è, –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫ |
| `maria@example.com` | user | 1 –∞–≤—Ç–æ–º–æ–±–∏–ª—å, –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫ |
| `alex@example.com` | user | 1 –∞–≤—Ç–æ–º–æ–±–∏–ª—å, –≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫ |
| `guard@gate.com` | guard | –û—Ö—Ä–∞–Ω–Ω–∏–∫, –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–ø—É—Å–∫–∞–º–∏ |

---

## –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –í—Ö–æ–¥ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö

1. **Test Users ‚Üí Login as Ivan**
   - –¢–æ–∫–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è
2. **Authentication ‚Üí Get Current User (Me)**
   - –ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
3. **Vehicles ‚Üí Get My Vehicles**
   - –£–≤–∏–¥–∏—à—å —Å–≤–æ–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏
4. **Passes ‚Üí Get My Passes**
   - –£–≤–∏–¥–∏—à—å —Å–≤–æ–∏ –ø—Ä–æ–ø—É—Å–∫–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è

1. **Authentication ‚Üí Register New User**
   - –°–æ–∑–¥–∞–π –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **Authentication ‚Üí Login**
   - –í–æ–π–¥–∏ –ø–æ–¥ –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
3. **Vehicles ‚Üí Create Vehicle**
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å
   - –ó–∞–º–µ–Ω–∏ `{{current_user_id}}` –Ω–∞ ID –∏–∑ `Get Current User`

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞–º–∏ (Admin/Guard)

1. **Test Users ‚Üí Login as Admin**
2. **Passes ‚Üí Create Pass**
   - –°–æ–∑–¥–∞–π –ø—Ä–æ–ø—É—Å–∫ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –£–∫–∞–∂–∏ `user_id` –∏ `vehicle_ids`
3. **Passes ‚Üí Get Pass by ID**
   - –ü—Ä–æ–≤–µ—Ä—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫
4. **Passes ‚Üí Revoke Pass**
   - –û—Ç–∑–æ–≤–∏ –ø—Ä–æ–ø—É—Å–∫

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ (Admin/Guard)

1. **Test Users ‚Üí Login as Guard**
2. **Access Control ‚Üí Get All Access Logs**
   - –ü—Ä–æ—Å–º–æ—Ç—Ä–∏ –≤—Å–µ –ø—Ä–æ–µ–∑–¥—ã
3. **Access Control ‚Üí Get Vehicle Access Logs**
   - –ò—Å—Ç–æ—Ä–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (Gate)

‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç ML —Å–µ—Ä–≤–∏—Å** (–ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ docker-compose)

1. **Access Control ‚Üí Check Access (Gate)**
   - –û—Ç–ø—Ä–∞–≤—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ (base64)
   - –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç:
     1. –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ (–±–µ–∑—É—Å–ª–æ–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø)
     2. –ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–±–µ–∑—É—Å–ª–æ–≤–Ω—ã–π –æ—Ç–∫–∞–∑)
     3. –ü—Ä–æ–ø—É—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## –ë–µ–ª—ã–π –∏ –ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–∫–∏ (Seed Data)

### –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ (–ë–µ–∑—É—Å–ª–æ–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø)
- `–ü001–ú–†777` - –ü–æ–ª–∏—Ü–∏—è
- `–°002–ú–ß777` - –ú–ß–°
- `–ê003–°–ü777` - –°–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å
- `–í999–ò–ü777` - VIP
- `–ì888–ì–û777` - –í—Ä–µ–º–µ–Ω–Ω—ã–π VIP (30 –¥–Ω–µ–π)

### –ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–ó–∞–ø—Ä–µ—â–µ–Ω –¥–æ—Å—Ç—É–ø)
- `–£777–ö–†199` - –£–≥–Ω–∞–Ω–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å
- `–ó666–õ–û777` - –ù–∞—Ä—É—à–∏—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞
- `–î123–ê–ë777` - –í—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (7 –¥–Ω–µ–π)

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ:

- `access_token` - JWT —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞
- `refresh_token` - –¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `current_user_id` - ID —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `base_url` - URL API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `http://localhost:8080`)

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ API
docker logs -f gate-api

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ PostgreSQL
docker logs -f gate-postgres

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make docker-down

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ë–î (–æ—á–∏—Å—Ç–∫–∞)
docker-compose -f docker/docker-compose.yml down -v
make docker-up
make migrate-up
make seed
```

---

## –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| 200 | OK - –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω |
| 201 | Created - —Ä–µ—Å—É—Ä—Å —Å–æ–∑–¥–∞–Ω |
| 400 | Bad Request - –Ω–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å |
| 401 | Unauthorized - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
| 403 | Forbidden - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ |
| 404 | Not Found - —Ä–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω |
| 409 | Conflict - –∫–æ–Ω—Ñ–ª–∏–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) |
| 500 | Internal Server Error - –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ |

---

## –ü—Ä–∏–º–µ—Ä—ã curl

### Login
```bash
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@gate.com","password":"password123"}'
```

### Get Current User
```bash
TOKEN="your_token_here"
curl http://localhost:8080/api/v1/auth/me \
  -H "Authorization: Bearer $TOKEN"
```

### Get My Vehicles
```bash
curl http://localhost:8080/api/v1/vehicles/me \
  -H "Authorization: Bearer $TOKEN"
```

---

## Troubleshooting

### API –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏
docker logs gate-api

# –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ PostgreSQL —Ä–∞–±–æ—Ç–∞–µ—Ç
docker ps | grep postgres

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π
make docker-rebuild
```

### –û—à–∏–±–∫–∞ "Invalid credentials"
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø–∞—Ä–æ–ª—å `password123`
- –£–±–µ–¥–∏—Å—å —á—Ç–æ seed data –∑–∞–≥—Ä—É–∂–µ–Ω—ã: `make seed`

### –û—à–∏–±–∫–∞ "Token expired"
- –ü–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Å—è: **Test Users ‚Üí Login as [User]**
- –¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### ML service unavailable
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, ML —Å–µ—Ä–≤–∏—Å –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ docker-compose
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
- `/api/v1/access/check` –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ ML

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ë–∞–∑–æ–≤–æ–µ API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
2. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å ML —Å–µ—Ä–≤–∏—Å –≤ docker-compose
3. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
4. ‚è≥ Frontend (Vue 3 + Pinia)

---

**–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é! üöÄ**
